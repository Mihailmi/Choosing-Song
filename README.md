# üéµ RAG –°–∏—Å—Ç–µ–º–∞ –í—ã–±–æ—Ä–∞ –ü–µ—Å–µ–Ω

–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤—ã–±–æ—Ä–∞ –ø–µ—Å–µ–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ **RAG (Retrieval-Augmented Generation)** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º embeddings –∏ LLM reasoning.

## üéØ –ß—Ç–æ —ç—Ç–æ?

–≠—Ç–æ –Ω–µ –æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ —Å –Ω—É–ª—è, –∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏–Ω–∂–µ–Ω–µ—Ä–Ω—ã–π –ø–æ–¥—Ö–æ–¥:
- **Semantic Search** —á–µ—Ä–µ–∑ embeddings –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –ø–µ—Å–µ–Ω
- **LLM Reasoning** –¥–ª—è –≤—ã–±–æ—Ä–∞ –ª—É—á—à–µ–π –ø–µ—Å–Ω–∏ –∏–∑ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ** –∏ **–¥–µ—à–µ–≤–æ** –≤ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
JSON (200 –ø–µ—Å–µ–Ω)
   ‚Üì
Embeddings (–æ–¥–∏–Ω —Ä–∞–∑)
   ‚Üì
Vector DB (FAISS)
   ‚Üì
User request ‚Üí Embedding –∑–∞–ø—Ä–æ—Å–∞
   ‚Üì
Top-K –ø–æ—Ö–æ–∂–∏—Ö –ø–µ—Å–µ–Ω
   ‚Üì
LLM –≤—ã–±–∏—Ä–∞–µ—Ç 1 + –æ–±—ä—è—Å–Ω—è–µ—Ç
```

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ API –∫–ª—é—á

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
OPENAI_API_KEY=your_openai_api_key_here
```

### 3. –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ –¥–∞–Ω–Ω—ã–µ

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª `Data/Songs.json` —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–µ—Å–Ω–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:

```json
[
  {
    "id": 1,
    "title": "–ù–∞–∑–≤–∞–Ω–∏–µ –ø–µ—Å–Ω–∏",
    "artist": "–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å",
    "lyrics": "–¢–µ–∫—Å—Ç –ø–µ—Å–Ω–∏...",
    "themes": ["—Ç–µ–º–∞1", "—Ç–µ–º–∞2"],
    "mood": ["–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ1", "–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ2"],
    "language": "ru"
  }
]
```

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ embeddings (–æ–¥–∏–Ω —Ä–∞–∑)

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –ë–î:

```bash
cd Source
python prepare_embeddings.py
```

–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç:
- `Data/songs_index.faiss` - FAISS –∏–Ω–¥–µ–∫—Å
- `Data/songs_metadata.json` - –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø–µ—Å–µ–Ω

**–í–∞–∂–Ω–æ:** –≠—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑! –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –ø–µ—Å–µ–Ω –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–Ω–æ–≤–∞.

### –®–∞–≥ 2: –ü–æ–∏—Å–∫ –∏ –≤—ã–±–æ—Ä –ø–µ—Å–µ–Ω

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç:

```bash
cd Source
python main.py
```

–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∑–∞–ø—Ä–æ—Å, –Ω–∞–ø—Ä–∏–º–µ—Ä:
- "–•–æ—á—É —á—Ç–æ-—Ç–æ —Å–ø–æ–∫–æ–π–Ω–æ–µ –¥–ª—è –≤–µ—á–µ—Ä–∞"
- "–ù—É–∂–Ω–∞ –ø–µ—Å–Ω—è –ø—Ä–æ –ª—é–±–æ–≤—å –∏ —Ä–∞—Å—Å—Ç–∞–≤–∞–Ω–∏–µ"
- "–ò—â—É —á—Ç–æ-—Ç–æ —ç–Ω–µ—Ä–≥–∏—á–Ω–æ–µ –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏"

–°–∏—Å—Ç–µ–º–∞:
1. –ù–∞–π–¥—ë—Ç 5 –Ω–∞–∏–±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –ø–µ—Å–µ–Ω
2. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç LLM –¥–ª—è –≤—ã–±–æ—Ä–∞ –ª—É—á—à–µ–π
3. –û–±—ä—è—Å–Ω–∏—Ç, –ø–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ —ç—Ç–∞ –ø–µ—Å–Ω—è –ø–æ–¥—Ö–æ–¥–∏—Ç

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ Data/
‚îÇ   ‚îú‚îÄ‚îÄ Songs.json              # –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –ø–µ—Å–Ω—è–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ songs_index.faiss       # FAISS –∏–Ω–¥–µ–∫—Å (—Å–æ–∑–¥–∞—ë—Ç—Å—è)
‚îÇ   ‚îî‚îÄ‚îÄ songs_metadata.json     # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (—Å–æ–∑–¥–∞—ë—Ç—Å—è)
‚îú‚îÄ‚îÄ Source/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ embeddings_manager.py   # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ embeddings
‚îÇ   ‚îú‚îÄ‚îÄ song_search.py          # –ü–æ–∏—Å–∫ –ø–µ—Å–µ–Ω
‚îÇ   ‚îú‚îÄ‚îÄ song_selector.py        # –í—ã–±–æ—Ä –ª—É—á—à–µ–π —á–µ—Ä–µ–∑ LLM
‚îÇ   ‚îú‚îÄ‚îÄ prepare_embeddings.py   # –°–∫—Ä–∏–ø—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ main.py                 # –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ .env                        # API –∫–ª—é—á–∏ (—Å–æ–∑–¥–∞–π—Ç–µ —Å–∞–º–∏)
‚îî‚îÄ‚îÄ README.md
```

## üß† –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–æ–¥–µ–ª–∏

### Embeddings
- **OpenAI text-embedding-3-large** (3072 —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å)
- –ú–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ bge-large, E5-large (open-source)

### LLM
- **GPT-4o-mini** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å GPT-4o, Claude 3.5, LLaMA 3

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ LLM

–í `Source/main.py` –∏–ª–∏ `Source/song_selector.py`:

```python
selector = SongSelector(api_key=api_key, model="gpt-4o")
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤

–í `Source/main.py`:

```python
candidates = search_engine.search(query, k=10)  # –í–º–µ—Å—Ç–æ 5
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤

–í `Source/main.py` –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `search_with_filters`:

```python
candidates = search_engine.search_with_filters(
    query, 
    k=5,
    language="ru",
    mood=["—Å–ø–æ–∫–æ–π–Ω–∞—è", "–∑–∞–¥—É–º—á–∏–≤–∞—è"]
)
```

## üí° –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ª—É—á—à–µ –æ–±—É—á–µ–Ω–∏—è?

| –ü–æ–¥—Ö–æ–¥ | –ü—Ä–æ–±–ª–µ–º—ã |
|--------|----------|
| Fine-tuning | –î–æ—Ä–æ–≥–æ, –Ω–µ –≥–∏–±–∫–æ, –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–æ–±—É—á–∞—Ç—å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö |
| –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã | –ù–µ –ø–æ–Ω–∏–º–∞—é—Ç –Ω—é–∞–Ω—Å—ã, —Ç—Ä–µ–±—É—é—Ç —Ä–∞–∑–º–µ—á–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö |
| –ü—Ä–∞–≤–∏–ª–∞ | –ù–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É—é—Ç—Å—è, —Ö—Ä—É–ø–∫–∏–µ |
| **RAG** | ‚úÖ –ì–∏–±–∫–æ, —É–º–Ω–æ, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ, –æ–±—ä—è—Å–Ω–∏–º–æ |

## üéì –ß—Ç–æ –≤—ã –∏–∑—É—á–∞–µ—Ç–µ

- **Embeddings** –∏ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫
- **Vector databases** (FAISS)
- **RAG –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É**
- **Prompt engineering**
- **LLM reasoning**

–≠—Ç–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è AI-–∏–Ω–∂–µ–Ω–µ—Ä–∏—è, –∞ –Ω–µ Data Science!

## üöÄ –î–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ

- [ ] –§–∏–ª—å—Ç—Ä—ã (—è–∑—ã–∫, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ, –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å)
- [ ] –î–∏–∞–ª–æ–≥–æ–≤—ã–π —Ä–µ–∂–∏–º —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- [ ] –ü–∞–º—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏—Å—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤)
- [ ] Feedback loop (–ª–∞–π–∫/–¥–∏–∑–ª–∞–π–∫)
- [ ] –õ–æ–∫–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏ (LLaMA, bge)
- [ ] –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- [ ] API endpoint

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

–û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è RAG –∏ AI-–∏–Ω–∂–µ–Ω–µ—Ä–∏–∏.

## ü§ù –í–∫–ª–∞–¥

–≠—Ç–æ —É—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç. –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ, —É–ª—É—á—à–∞–π—Ç–µ, –¥–µ–ª–∏—Ç–µ—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏!

