# –ê–Ω–∞–ª–∏–∑ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —Å–∏—Å—Ç–µ–º–µ

## –¢–∏–ø—ã –∫—ç—à–∞ –≤ —Å–∏—Å—Ç–µ–º–µ

–í —Å–∏—Å—Ç–µ–º–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–¥–≤–∞ —Ç–∏–ø–∞ –∫—ç—à–∞**:

---

## 1. Backend –∫—ç—à (Embeddings –∑–∞–ø—Ä–æ—Å–æ–≤)

### –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ
- **–§–∞–π–ª**: `Source/embeddings_manager.py`
- **–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è**: `self._query_embedding_cache`
- **–¢–∏–ø**: –°–ª–æ–≤–∞—Ä—å Python –≤ –ø–∞–º—è—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞

### –ß—Ç–æ –∫—ç—à–∏—Ä—É–µ—Ç—Å—è
- Embeddings –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ö–ª—é—á: MD5 —Ö—ç—à –æ—Ç —Ç–µ–∫—Å—Ç–∞ –∑–∞–ø—Ä–æ—Å–∞
- –ó–Ω–∞—á–µ–Ω–∏–µ: NumPy –º–∞—Å—Å–∏–≤ —Å –≤–µ–∫—Ç–æ—Ä–æ–º (768 —á–∏—Å–µ–ª)

### –í—Ä–µ–º—è —Ö—Ä–∞–Ω–µ–Ω–∏—è
- ‚ö†Ô∏è **–ù–ï–¢ TTL (–≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏)**
- –•—Ä–∞–Ω–∏—Ç—Å—è **–¥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞**
- –ò–ª–∏ –¥–æ –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏—è –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- **–ú–∞–∫—Å–∏–º—É–º**: 1000 –∑–∞–ø–∏—Å–µ–π
- **–°—Ç—Ä–∞—Ç–µ–≥–∏—è –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏—è**: FIFO (First In, First Out)
- –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ —É–¥–∞–ª—è–µ—Ç—Å—è —Å–∞–º–∞—è —Å—Ç–∞—Ä–∞—è –∑–∞–ø–∏—Å—å

### –ö–æ–¥
```python
# –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à (–æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –∫—ç—à–∞ –¥–æ 1000 –∑–∞–ø–∏—Å–µ–π)
if len(self._query_embedding_cache) >= 1000:
    # –£–¥–∞–ª—è–µ–º —Å–∞–º—É—é —Å—Ç–∞—Ä—É—é –∑–∞–ø–∏—Å—å (FIFO)
    oldest_key = next(iter(self._query_embedding_cache))
    del self._query_embedding_cache[oldest_key]

self._query_embedding_cache[cache_key] = embedding_array
```

### –ü—Ä–æ–±–ª–µ–º—ã —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
1. ‚ùå **–ù–µ—Ç TTL** - —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ –º–æ–≥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ (–µ—Å–ª–∏ –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç)
2. ‚ùå **FIFO –Ω–µ –æ–ø—Ç–∏–º–∞–ª–µ–Ω** - —É–¥–∞–ª—è–µ—Ç –ø–æ –ø–æ—Ä—è–¥–∫—É, –∞ –Ω–µ –ø–æ —á–∞—Å—Ç–æ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
3. ‚ùå **–¢–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ** - –≤–µ—Å—å –∫—ç—à –æ—á–∏—â–∞–µ—Ç—Å—è

---

## 2. Frontend –∫—ç—à (–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∏—Å–∫–∞)

### –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ
- **–§–∞–π–ª**: `Source/static/script.js`
- **–•—Ä–∞–Ω–∏–ª–∏—â–µ**: `localStorage` –±—Ä–∞—É–∑–µ—Ä–∞
- **–ö–ª—é—á**: `'searchHistory'`

### –ß—Ç–æ –∫—ç—à–∏—Ä—É–µ—Ç—Å—è
- –ü–æ–ª–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ (–∫–∞–Ω–¥–∏–¥–∞—Ç—ã, –≤—ã–±—Ä–∞–Ω–Ω–∞—è –ø–µ—Å–Ω—è, –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ)
- –ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- Timestamp –∑–∞–ø—Ä–æ—Å–∞

### –í—Ä–µ–º—è —Ö—Ä–∞–Ω–µ–Ω–∏—è
- ‚ö†Ô∏è **–ù–ï–¢ TTL (–≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏)**
- –•—Ä–∞–Ω–∏—Ç—Å—è **–¥–æ –æ—á–∏—Å—Ç–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞** –∏–ª–∏ —Ä—É—á–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ localStorage
- –ò–ª–∏ –¥–æ –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏—è –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- **–ú–∞–∫—Å–∏–º—É–º**: 10 –∑–∞–ø–∏—Å–µ–π
- **–°—Ç—Ä–∞—Ç–µ–≥–∏—è –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏—è**: FIFO (—É–¥–∞–ª—è—é—Ç—Å—è —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏)
- Timestamp —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –Ω–æ **–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è**

### –ö–æ–¥
```javascript
function saveSearchHistory(query, result) {
    const history = JSON.parse(localStorage.getItem('searchHistory') || '[]');
    history.unshift({
        query: query,
        timestamp: Date.now(),
        selectedTitle: result.selected?.title || null,
        cachedResult: result
    });
    // –•—Ä–∞–Ω–∏–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –∑–∞–ø–∏—Å–µ–π
    const limitedHistory = history.slice(0, 10);
    localStorage.setItem('searchHistory', JSON.stringify(limitedHistory));
}
```

### –ü—Ä–æ–±–ª–µ–º—ã —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
1. ‚ùå **–ù–µ—Ç TTL** - —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ –º–æ–≥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –º–µ—Å—è—Ü–∞–º–∏
2. ‚ùå **Timestamp –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è** - —Ç–æ–ª—å–∫–æ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
3. ‚ùå **FIFO –Ω–µ –æ–ø—Ç–∏–º–∞–ª–µ–Ω** - —É–¥–∞–ª—è–µ—Ç –ø–æ –ø–æ—Ä—è–¥–∫—É, –∞ –Ω–µ –ø–æ –¥–∞–≤–Ω–æ—Å—Ç–∏

---

## –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –ü–∞—Ä–∞–º–µ—Ç—Ä | Backend –∫—ç—à | Frontend –∫—ç—à |
|----------|-------------|--------------|
| **–¢–∏–ø** | –ü–∞–º—è—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞ | localStorage |
| **–†–∞–∑–º–µ—Ä** | 1000 –∑–∞–ø–∏—Å–µ–π | 10 –∑–∞–ø–∏—Å–µ–π |
| **TTL** | ‚ùå –ù–µ—Ç | ‚ùå –ù–µ—Ç |
| **–í—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ** | FIFO | FIFO |
| **–°–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç—å** | –î–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ | –î–æ –æ—á–∏—Å—Ç–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞ |
| **–ß—Ç–æ –∫—ç—à–∏—Ä—É–µ—Ç—Å—è** | Embeddings | –ü–æ–ª–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã |

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

### 1. –î–æ–±–∞–≤–∏—Ç—å TTL –¥–ª—è Backend –∫—ç—à–∞

**–ü—Ä–æ–±–ª–µ–º–∞**: –°—Ç–∞—Ä—ã–µ embeddings –º–æ–≥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ.

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å timestamp –∏ –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–µ:

```python
import time

# –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
self._query_embedding_cache[cache_key] = {
    'embedding': embedding_array,
    'timestamp': time.time()
}

# –ü—Ä–∏ —á—Ç–µ–Ω–∏–∏
cache_entry = self._query_embedding_cache.get(cache_key)
if cache_entry:
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º TTL (–Ω–∞–ø—Ä–∏–º–µ—Ä, 24 —á–∞—Å–∞)
    if time.time() - cache_entry['timestamp'] < 86400:
        return cache_entry['embedding']
    else:
        # –£–¥–∞–ª—è–µ–º —É—Å—Ç–∞—Ä–µ–≤—à—É—é –∑–∞–ø–∏—Å—å
        del self._query_embedding_cache[cache_key]
```

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π TTL**: 24 —á–∞—Å–∞ (86400 —Å–µ–∫—É–Ω–¥)

### 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å LRU –≤–º–µ—Å—Ç–æ FIFO

**–ü—Ä–æ–±–ª–µ–º–∞**: FIFO —É–¥–∞–ª—è–µ—Ç –ø–æ –ø–æ—Ä—è–¥–∫—É, –∞ –Ω–µ –ø–æ —á–∞—Å—Ç–æ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `collections.OrderedDict` –∏–ª–∏ `functools.lru_cache`:

```python
from collections import OrderedDict

class LRUCache:
    def __init__(self, max_size=1000):
        self.cache = OrderedDict()
        self.max_size = max_size
    
    def get(self, key):
        if key in self.cache:
            # –ü–µ—Ä–µ–º–µ—â–∞–µ–º –≤ –∫–æ–Ω–µ—Ü (—Å–∞–º—ã–π —Å–≤–µ–∂–∏–π)
            self.cache.move_to_end(key)
            return self.cache[key]
        return None
    
    def put(self, key, value):
        if key in self.cache:
            self.cache.move_to_end(key)
        else:
            if len(self.cache) >= self.max_size:
                # –£–¥–∞–ª—è–µ–º —Å–∞–º—ã–π —Å—Ç–∞—Ä—ã–π (–ø–µ—Ä–≤—ã–π)
                self.cache.popitem(last=False)
        self.cache[key] = value
```

### 3. –î–æ–±–∞–≤–∏—Ç—å TTL –¥–ª—è Frontend –∫—ç—à–∞

**–ü—Ä–æ–±–ª–µ–º–∞**: –ò—Å—Ç–æ—Ä–∏—è –º–æ–∂–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –º–µ—Å—è—Ü–∞–º–∏.

**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—è—Ç—å timestamp –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ:

```javascript
function loadSearchHistory() {
    const history = JSON.parse(localStorage.getItem('searchHistory') || '[]');
    const now = Date.now();
    const TTL = 7 * 24 * 60 * 60 * 1000; // 7 –¥–Ω–µ–π
    
    // –§–∏–ª—å—Ç—Ä—É–µ–º —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∑–∞–ø–∏—Å–∏
    const validHistory = history.filter(item => {
        return (now - item.timestamp) < TTL;
    });
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—á–∏—â–µ–Ω–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é
    if (validHistory.length !== history.length) {
        localStorage.setItem('searchHistory', JSON.stringify(validHistory));
    }
    
    return validHistory;
}
```

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π TTL**: 7 –¥–Ω–µ–π

### 4. –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ Backend –∫—ç—à–∞

**–ü—Ä–æ–±–ª–µ–º–∞**: –ö—ç—à —Ç–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞.

**–†–µ—à–µ–Ω–∏–µ**: –°–æ—Ö—Ä–∞–Ω—è—Ç—å –∫—ç—à –Ω–∞ –¥–∏—Å–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ Redis –∏–ª–∏ —Ñ–∞–π–ª):

```python
import pickle
import os

CACHE_FILE = 'cache/embeddings_cache.pkl'

def save_cache(self):
    """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫—ç—à –Ω–∞ –¥–∏—Å–∫"""
    os.makedirs('cache', exist_ok=True)
    with open(CACHE_FILE, 'wb') as f:
        pickle.dump(self._query_embedding_cache, f)

def load_cache(self):
    """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –∫—ç—à —Å –¥–∏—Å–∫–∞"""
    if os.path.exists(CACHE_FILE):
        with open(CACHE_FILE, 'rb') as f:
            self._query_embedding_cache = pickle.load(f)
```

---

## –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è —Ö—Ä–∞–Ω–µ–Ω–∏—è (—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ)

### Backend –∫—ç—à:
- **–ú–∏–Ω–∏–º—É–º**: –î–æ –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏—è –ø—Ä–∏ 1000+ –∑–∞–ø–∏—Å—è—Ö
- **–ú–∞–∫—Å–∏–º—É–º**: –î–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
- **–¢–∏–ø–∏—á–Ω–æ**: –ù–µ—Å–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤/–¥–Ω–µ–π (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–∞–≥—Ä—É–∑–∫–∏)

### Frontend –∫—ç—à:
- **–ú–∏–Ω–∏–º—É–º**: –î–æ –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏—è –ø—Ä–∏ 10+ –∑–∞–ø–∏—Å—è—Ö
- **–ú–∞–∫—Å–∏–º—É–º**: –î–æ –æ—á–∏—Å—Ç–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (–º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ—Å—è—Ü–∞–º–∏)
- **–¢–∏–ø–∏—á–Ω–æ**: –ù–µ—Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π/–Ω–µ–¥–µ–ª—å

---

## –í—ã–≤–æ–¥—ã

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚ö†Ô∏è –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
- ‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è FIFO

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
1. **–î–æ–±–∞–≤–∏—Ç—å TTL** –¥–ª—è –æ–±–æ–∏—Ö –∫—ç—à–µ–π
2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å LRU** –≤–º–µ—Å—Ç–æ FIFO –¥–ª—è backend
3. **–û—á–∏—â–∞—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∑–∞–ø–∏—Å–∏** –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ frontend –∫—ç—à–∞
4. **–†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ** –¥–ª—è backend (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —É–ª—É—á—à–µ–Ω–∏–π:
1. üî¥ **–í—ã—Å–æ–∫–∏–π**: TTL –¥–ª—è frontend –∫—ç—à–∞ (–ø—Ä–æ—Å—Ç–æ–µ, –Ω–æ –≤–∞–∂–Ω–æ–µ)
2. üü° **–°—Ä–µ–¥–Ω–∏–π**: TTL –¥–ª—è backend –∫—ç—à–∞
3. üü¢ **–ù–∏–∑–∫–∏–π**: LRU –≤–º–µ—Å—Ç–æ FIFO (—É–ª—É—á—à–µ–Ω–∏–µ, –Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)
4. üü¢ **–ù–∏–∑–∫–∏–π**: –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –≤—ã—Å–æ–∫–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å)
